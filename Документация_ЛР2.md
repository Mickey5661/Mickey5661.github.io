# Документация к лабораторной работе 2  
## Список туров туристической фирмы (вариант 4)

---

## 1. Цель работы и состав проекта

**Цель:** реализовать веб-сервис на Django в соответствии с вариантом задания. Выполнен **вариант 4 — «Список туров туристической фирмы»**.

**Состав проекта:**

- Веб-сервис — каталог туров с поиском и пагинацией.
- Регистрация и авторизация пользователей.
- Резервирование туров — пользователь может создавать, редактировать (примечание) и удалять свои резервирования.
- Отзывы к турам — с указанием дат тура, текста комментария и рейтинга от 1 до 10; сохраняется информация об авторе.
- Админ-панель Django — управление турами, резервированиями и отзывами; администратор может подтверждать резервирования (переводить в статус «продано»).
- Таблица «Проданные туры по странам» — на клиенте формируется таблица всех проданных (подтверждённых) туров, сгруппированных по странам.

**Дополнительные требования ЛР2:** меню (Bootstrap 5), пагинация по 5 туров на страницу, поиск по названию/описанию/турагентству. Все выполнены.

**Быстрый старт:**

```
pip install -r requirements.txt
python manage.py migrate
python manage.py createsuperuser
python manage.py runserver 8001
```

Сайт: http://127.0.0.1:8001/  
Админка: http://127.0.0.1:8001/admin/

---

## 2. Установка и запуск

**Требования:** Python 3.8+, PyCharm или любой редактор и терминал.

1. **Открыть проект** — PyCharm → File → Open → папка `Web Laba 2 Mob`.
2. **Интерпретатор** — File → Settings → Project → Python Interpreter → выбрать Python 3 или создать venv.
3. **Зависимости** — в терминале из корня проекта: `pip install -r requirements.txt`.
4. **Миграции** — `python manage.py migrate` (создаётся/обновляется `db.sqlite3`).
5. **Администратор** — `python manage.py createsuperuser` (логин, email, пароль).
6. **Запуск сервера** — конфигурация Run Server в PyCharm или в терминале: `python manage.py runserver 8001`.
7. **Браузер** — главная: http://127.0.0.1:8001/ , админка: http://127.0.0.1:8001/admin/

В админке в разделе «Туры» добавьте туры; для страницы «Проданные по странам» у туров нужно указать поле «Страна».

---

## 3. Задание и соответствие требованиям

### Данные по туру

| Требование              | Реализация в проекте                          |
|--------------------------|-----------------------------------------------|
| Название тура            | Поле `name` модели `Tour`                     |
| Турагентство             | Поле `travel_agency` модели `Tour`           |
| Описание тура            | Поле `description` модели `Tour`              |
| Период проведения тура  | Поле `period` модели `Tour`                   |
| Условия оплаты          | Поле `payment_conditions` модели `Tour`      |
| Дополнительно           | Поле `country` — для таблицы по странам       |

### Функционал

| Требование                           | Реализация |
|--------------------------------------|------------|
| Регистрация новых пользователей     | Страница `/register/`, форма (логин, пароль). После регистрации — автоматический вход. |
| Просмотр и резервирование туров     | Главная — список туров; страница тура — кнопка «Зарезервировать тур». Модель `Reservation`. |
| Редактирование и удаление своих резервирований | «Мои резервирования»: редактирование примечания, удаление с подтверждением. Доступ только к своим записям. |
| Написание отзывов к турам           | На странице тура: даты тура, текст, рейтинг 1–10; сохраняются автор (User). Модель `Review`. |
| Подтверждение резервирования в Django-admin | В админке раздел «Резервирования» → действие «Подтвердить резервирования» → статус «Подтверждено (продано)». |
| Таблица проданных туров по странам  | Страница `/sold-by-country/`: по каждой стране — туры и количество продаж (подтверждённых резервирований). |

### Доп. требования ЛР2

- **Меню** — Bootstrap 5 в `base.html`: Главная, Мои резервирования, Проданные по странам, Админка, Вход/Регистрация или имя и Выход; адаптивное меню (бургер).
- **Пагинация** — по 5 туров на страницу; в ссылках пагинации сохраняется параметр поиска `q`.
- **Поиск** — GET-параметр `q`, фильтр по названию, описанию, турагентству.

---

## 4. Модели данных

Файл: `tours/models.py`. База: SQLite (`db.sqlite3`).

### Tour (Тур)

| Поле                 | Тип        | Описание |
|----------------------|------------|----------|
| name                 | CharField(200) | Название тура |
| travel_agency        | CharField(200) | Турагентство |
| description         | TextField  | Описание (необязательно) |
| period              | CharField(200) | Период проведения (необязательно) |
| payment_conditions  | TextField  | Условия оплаты (необязательно) |
| country             | CharField(100) | Страна (для таблицы по странам) |
| created_at          | DateTimeField | Дата добавления (авто) |

Связи: у тура много резервирований и много отзывов.

### Reservation (Резервирование)

| Поле       | Тип           | Описание |
|------------|---------------|----------|
| user       | ForeignKey → User | Пользователь |
| tour       | ForeignKey → Tour | Тур |
| note       | CharField(300) | Примечание (пользователь может редактировать) |
| created_at | DateTimeField | Дата создания |
| status     | CharField     | `pending` (ожидает) или `confirmed` (продано) |

При удалении пользователя или тура резервирования удаляются (CASCADE).

### Review (Отзыв)

| Поле       | Тип           | Описание |
|------------|---------------|----------|
| user       | ForeignKey → User | Автор |
| tour       | ForeignKey → Tour | Тур |
| tour_dates | CharField(200) | Даты тура (необязательно) |
| text       | TextField     | Текст комментария |
| rating     | PositiveSmallIntegerField | Рейтинг 1–10 |
| created_at | DateTimeField | Дата отзыва |

Таблица «проданные по странам» строится по `Reservation` со статусом `confirmed`; группировка по `tour.country`.

**Схема связей:** User → много Reservation → Tour; User → много Review → Tour.

---

## 5. Страницы и сценарии

### Маршруты (URL)

| URL                          | Назначение |
|-----------------------------|------------|
| `/`                         | Главная — список туров с поиском и пагинацией |
| `/tour/<id>/`               | Страница тура: описание, резервирование, отзывы |
| `/register/`                 | Регистрация |
| `/login/`                   | Вход |
| `/logout/`                  | Выход |
| `/my-reservations/`         | Мои резервирования (только для авторизованных) |
| `/my-reservations/<id>/edit/`   | Редактирование примечания к резервированию |
| `/my-reservations/<id>/delete/` | Удаление резервирования (с подтверждением) |
| `/sold-by-country/`         | Таблица проданных туров по странам |
| `/admin/`                   | Админ-панель Django |

### Сценарии

**Гость:** главная — список, поиск, пагинация; страница тура — описание без кнопок резерва/отзыва (предложение войти или зарегистрироваться). Меню: Главная, Проданные по странам, Админка, Вход, Регистрация.

**Регистрация и вход:** форма регистрации → после успеха автоматический вход и переход на главную. Вход — логин/пароль, переход на главную или на `next`.

**Авторизованный пользователь:** на странице тура — «Зарезервировать тур» (создаётся резервирование со статусом «Ожидает»); форма отзыва (даты, текст, рейтинг 1–10). «Мои резервирования» — список своих резервирований; кнопки «Редактировать» (примечание) и «Удалить» (с подтверждением). Если резервирование этого тура уже есть — кнопка «Зарезервировать» не показывается.

**Администратор:** вход в `/admin/`. Раздел «Резервирования» → отметить записи → действие «Подтвердить резервирования» → статус «Подтверждено (продано)». Подтверждённые туры попадают на страницу «Проданные по странам».

**Проданные по странам:** доступна всем из меню; группировка по стране тура; в каждой стране — таблица: тур, турагентство, количество продаж. Если подтверждённых резервирований нет — сообщение о пустой таблице.

---

## 6. Технологии и структура проекта

**Стек:** Python 3.8+, Django 4.2+, SQLite, Bootstrap 5 (CDN).

**Структура:**

```
Web Laba 2 Mob/
├── manage.py
├── requirements.txt
├── lab2/                 # настройки Django (settings, urls, wsgi)
├── tours/                 # приложение «Туры»
│   ├── models.py          # Tour, Reservation, Review
│   ├── views.py           # список, деталь, регистрация, вход/выход, мои резервы, проданные по странам
│   ├── urls.py            # маршруты приложения
│   ├── forms.py           # регистрация, отзыв, редактирование примечания резерва
│   ├── admin.py           # админка, действие «Подтвердить резервирования»
│   └── templates/tours/   # base, tour_list, tour_detail, register, login, my_reservations и др.
└── db.sqlite3
```

**Настройки (lab2/settings.py):** INSTALLED_APPS включает `tours`; ROOT_URLCONF = lab2.urls; БД — SQLite; LOGIN_URL, LOGIN_REDIRECT_URL, LOGOUT_REDIRECT_URL; язык ru-ru, часовой пояс Europe/Moscow.

---

*Конец документации.*
