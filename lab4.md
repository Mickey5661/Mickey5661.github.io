# Документация к лабораторной работе 4  
## Система управления гостиницей

**Автор:** Лазарев Марк

---

## 1. Назначение проекта

Веб-приложение для учёта номеров, клиентов, проживаний и персонала гостиницы. Пользователи могут просматривать данные, бронировать номера; администраторы — создавать номера, клиентов и проживания, просматривать отчёты и управлять данными через Django Admin.

---

## 2. Структура проекта

```
lr4/
├── hotel-backend/                 # Бэкенд (Django REST API)
│   ├── hotel_system/              # Настройки проекта (settings, urls)
│   ├── hotel/                     # Приложение «Гостиница»
│   │   ├── models.py              # Модели данных
│   │   ├── views.py               # Представления (эндпоинты API)
│   │   ├── urls.py                # Маршруты API
│   │   ├── serializers.py         # Сериализаторы
│   │   ├── djoser_serializers.py  # Сериализатор пользователя с is_superuser
│   │   └── admin.py               # Регистрация в админке
│   ├── docs/                      # Документация MkDocs
│   ├── manage.py
│   ├── requirements.txt
│   └── venv/
├── hotel-frontend/                # Фронтенд (Vue 3)
│   ├── src/
│   │   ├── views/                 # Страницы (Rooms, Clients, Stays, Booking, Reports, Login, Register)
│   │   ├── services/api.js        # Обращения к API
│   │   ├── router/index.ts       # Маршруты SPA
│   │   └── App.vue
│   ├── package.json
│   └── vite.config.ts
├── ЗАПУСК_И_ПРОВЕРКА.md          # Подробная инструкция по запуску и проверке через Postman
├── ВОПРОСЫ_И_ОТВЕТЫ.md           # Ответы на типовые вопросы (роли, вьюшки, сложные запросы, эндпоинты)
└── ДОКУМЕНТАЦИЯ.md               # Этот файл
```

---

## 3. Технологии

| Часть      | Стек |
|------------|------|
| Бэкенд     | Python, Django 6, Django REST Framework, Djoser (пользователи и токены), django-filter, drf-yasg (Swagger/ReDoc), django-cors-headers, SQLite |
| Фронтенд   | Vue 3, Vite, Vuetify 3, Vue Router, Pinia, Axios |
| Аутентификация | Token (Djoser): POST `token/login/`, заголовок `Authorization: Token <токен>` |

---

## 4. Модели данных (бэкенд)

| Модель | Описание | Основные поля |
|--------|----------|----------------|
| **Room** | Номер комнаты | number, type (single/double/triple), floor, phone, price_per_day |
| **Client** | Гость (клиент) | passport, last_name, first_name, patronymic, city |
| **Stay** | Проживание (бронь) | client, room, check_in, check_out |
| **Staff** | Сотрудник | last_name, first_name, patronymic |
| **CleaningSchedule** | Расписание уборки | staff, floor, day (mon…sun) |

Связи: Stay → Client, Stay → Room; CleaningSchedule → Staff. Уникальные ограничения: комната + дата заселения (одна бронь на номер на дату); служащий + этаж + день (одна запись в расписании).

---

## 5. API (обзор)

Базовый URL: **http://127.0.0.1:8000/api/v1/**

### Авторизация (Djoser)

- **POST** `users/` — регистрация.
- **POST** `token/login/` — вход, в ответе `auth_token`.
- **GET** `users/me/` — текущий пользователь (в т.ч. `is_superuser`, `is_staff`).
- **POST** `token/logout/` — выход.

### Основные ресурсы

| Метод | URL | Описание |
|-------|-----|----------|
| GET, POST | `rooms/` | Список и создание номеров (POST — только админ). |
| GET, PUT, PATCH, DELETE | `rooms/<id>/` | Один номер. |
| GET, POST | `clients/` | Список и создание клиентов (POST — любой авторизованный). |
| GET, POST | `stays/` | Список и создание проживаний (POST — любой авторизованный, бронирование). |
| GET, PUT, PATCH, DELETE | `stays/<id>/` | Одно проживание. |
| GET, POST | `staff/` | Список и создание персонала. |
| GET, POST | `schedules/` | Расписание уборки (фильтры floor, day). |

### Служебные и отчёты

| Метод | URL | Описание |
|-------|-----|----------|
| GET | `queries/free-rooms/` | Количество свободных номеров на сегодня. |
| GET | `queries/free-rooms-list/?start_date=&end_date=` | Список свободных номеров за период. |
| GET | `queries/clients-in-room/?room_number=&start_date=&end_date=` | Клиенты в номере за период. |
| GET | `queries/clients-from-city/?city=` | Количество клиентов из города. |
| GET | `queries/staff-for-client/?passport=&day=` | Служащие, убиравшие номер клиента в заданный день. |
| GET | `report/quarter/<1-4>/` | Квартальный отчёт (доход, клиенты по номерам и т.д.). |

Подробные примеры тел запросов и ответов — в **ЗАПУСК_И_ПРОВЕРКА.md** и в Swagger: http://127.0.0.1:8000/swagger/

---

## 6. Роли и права

| Действие | Обычный пользователь | Администратор |
|----------|----------------------|----------------|
| Вход, регистрация | ✓ | ✓ |
| Просмотр номеров, клиентов, проживаний | ✓ | ✓ |
| Просмотр свободных номеров, бронирование | ✓ | ✓ |
| Добавление клиента (для себя/гостя) | ✓ | ✓ |
| Создание номера | ✗ | ✓ |
| Создание проживания (бронь) | ✓ | ✓ |
| Страница «Отчеты» | ✗ | ✓ |
| Ссылка «Админ-панель» (Django Admin) | ✗ | ✓ |
| Паспорт в списке клиентов | не отображается | отображается |

Роль определяется по полю `is_superuser` в ответе **GET** `users/me/`. На бэкенде создание номеров ограничено правом `IsAdminUser` (см. **ВОПРОСЫ_И_ОТВЕТЫ.md**).

---

## 7. Функции приложения (фронтенд)

- **Главная** — приветствие и переход к входу.
- **Вход / Регистрация** — получение токена, сохранение роли (админ/пользователь).
- **Номера** — таблица номеров; кнопка «Добавить номер» только у админа.
- **Бронирование** — выбор дат, список свободных номеров за период, форма брони с выбором гостя (клиента).
- **Клиенты** — таблица клиентов; добавление клиента доступно любому авторизованному; паспорт в таблице только у админа.
- **Проживания** — таблица проживаний; кнопка «Добавить проживание» только у админа.
- **Отчеты** — доступ только админу; квартальные отчёты по данным API.
- **Админ-панель** — ссылка в шапке только у админа, открывает Django Admin в новой вкладке.

Защита маршрутов: `/booking` — только для авторизованных; `/reports` — только для админа (редирект при отсутствии прав).

---

## 8. Запуск проекта

1. **Бэкенд:** в папке `hotel-backend`: активировать venv, выполнить `pip install -r requirements.txt`, `python manage.py migrate`, `python manage.py runserver`.
2. **Фронтенд:** в папке `hotel-frontend`: `npm install`, `npm run dev`.

Подробная пошаговая инструкция — в файле **ЗАПУСК_И_ПРОВЕРКА.md**.

После запуска:
- Сайт: http://localhost:5173  
- API: http://127.0.0.1:8000/api/v1/  
- Swagger: http://127.0.0.1:8000/swagger/  
- Админка Django: http://127.0.0.1:8000/admin/ (логин/пароль суперпользователя из `createsuperuser`).

---

## 9. Документы проекта

| Файл | Содержание |
|------|------------|
| **ДОКУМЕНТАЦИЯ.md** | Общее описание проекта (этот файл). |
| **ЗАПУСК_И_ПРОВЕРКА.md** | Запуск бэкенда и фронтенда, проверка API через Postman, примеры JSON. |
| **ВОПРОСЫ_И_ОТВЕТЫ.md** | Разделение админа и пользователя, вьюшки, сложные запросы, эндпоинты. |
| **hotel-backend/docs/** | Документация API (MkDocs), в т.ч. api/endpoints.md. |

---

*Лабораторная работа 4. Система управления гостиницей. Автор: Лазарев Марк.*
